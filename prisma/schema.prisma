generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Jurisdiction {
  id             String          @id @default(uuid())
  name           String
  code           String          @unique
  country        String
  type           String
  description    String?
  website        String?
  active         Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  incentiveRules IncentiveRule[]
  productions    Production[]

  @@map("jurisdictions")
}

model IncentiveRule {
  id               String       @id @default(uuid())
  jurisdictionId   String
  jurisdiction     Jurisdiction @relation(fields: [jurisdictionId], references: [id], onDelete: Cascade)
  ruleName         String
  ruleCode         String       @unique
  incentiveType    String
  percentage       Float?
  fixedAmount      Float?
  minSpend         Float?
  maxCredit        Float?
  eligibleExpenses String[]
  excludedExpenses String[]
  effectiveDate    DateTime
  expirationDate   DateTime?
  requirements     String?
  active           Boolean      @default(true)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  @@index([jurisdictionId])
  @@map("incentive_rules")
}

model Production {
  id                String       @id @default(uuid())
  title             String
  productionType    String
  jurisdictionId    String
  jurisdiction      Jurisdiction @relation(fields: [jurisdictionId], references: [id])
  budgetTotal       Float
  budgetQualifying  Float?
  startDate         DateTime
  endDate           DateTime?
  productionCompany String
  status            String
  contact           String?
  metadata          String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  expenses          Expense[]

  @@index([jurisdictionId])
  @@index([status])
  @@map("productions")
}

model Expense {
  id             String     @id @default(uuid())
  productionId   String
  production     Production @relation(fields: [productionId], references: [id], onDelete: Cascade)
  category       String
  subcategory    String?
  description    String
  amount         Float
  expenseDate    DateTime
  paymentDate    DateTime?
  isQualifying   Boolean    @default(true)
  qualifyingNote String?
  vendorName     String?
  vendorLocation String?
  receiptNumber  String?
  invoiceNumber  String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@index([productionId])
  @@index([expenseDate])
  @@map("expenses")
}model Expense {
  id           String   @id @default(cuid())

  // SAFE for existing rows (prevents Prisma reset prompt)
  productionId String?
  category     String   @default("uncategorized")
  expenseDate  DateTime @default(now())
  updatedAt    DateTime @default(now()) @updatedAt

  // keep/adjust other fields to match your app
  description  String?
  vendor       String?
  amount       Float
  currency     String   @default("USD")
  createdAt    DateTime @default(now())

  production   Production? @relation(fields: [productionId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@index([productionId])
  @@map("expenses")
}

